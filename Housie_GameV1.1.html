<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Housie Host</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: white;
    }

    h1 {
      text-align: center;
      margin: 10px 0;
      font-size: 28px;
    }

    .layout {
      display: grid;
      grid-template-columns: 220px 1fr 280px;
      gap: 12px;
      padding: 10px 16px 20px;
      height: calc(100vh - 60px);
      box-sizing: border-box;
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 12px;
      position: sticky;
      top: 10px;
    }

    .controls button, .controls select {
      padding: 14px 12px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    .controls button { background: #22c55e; }
    .controls .reset-btn { background: #ef4444; }
    .controls .fs-btn { background: #3b82f6; }

    .last-container {
      background: #020617;
      border: 4px solid #22c55e;
      border-radius: 14px;
      padding: 14px;
      text-align: center;
      position: sticky;
      top: 10px;
    }

    .last-number {
      font-size: 64px;
      font-weight: bold;
      margin: 8px 0;
      color: #22c55e;
    }

    .glow {
      animation: glow 1s ease-in-out 3;
      box-shadow: 0 0 20px #fde047, 0 0 40px #fde047;
    }

    @keyframes glow {
      0% { box-shadow: 0 0 5px #fde047; }
      50% { box-shadow: 0 0 30px #fde047; }
      100% { box-shadow: 0 0 5px #fde047; }
    }

    #board {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 12px;
      width: 100%;
      align-content: start;
    }

    .cell {
      background: #1e293b;
      padding: 20px 0;
      border-radius: 10px;
      font-weight: bold;
      font-size: 24px;
      text-align: center;
    }

    .drawn { background: red; }

    .history {
      margin-top: 12px;
      background: #020617;
      border-radius: 10px;
      padding: 10px;
      font-size: 14px;
      text-align: center;
    }

    .history span {
      display: inline-block;
      background: #1e293b;
      padding: 6px 10px;
      border-radius: 6px;
      margin: 4px;
    }
  </style>
</head>
<body>

  <h1>üé≤ Housie Host</h1>

  <div class="layout">
    <div class="controls">
      <button id="drawBtn" onclick="drawNumber()">üéØ Draw Number</button>
      <button class="reset-btn" onclick="resetGame()">üîÅ Reset</button>
      <button class="fs-btn" onclick="toggleFullscreen()">üñ• Fullscreen</button>

      <select id="speedSelect">
        <option value="2000" selected>‚è© 2 second</option>
        <option value="3000">‚è© 3 seconds</option>
        <option value="4000">‚è© 4 seconds</option>
        <option value="5000">‚è© 5 seconds</option>
      </select>

      <button onclick="startAutoDraw()">‚ñ∂ Start Auto</button>
      <button onclick="stopAutoDraw()">‚èπ Stop Auto</button>
    </div>

    <div id="board"></div>

    <div>
      <div class="last-container glow" id="lastBox">
        <div style="font-size:14px;color:#a7f3d0;">LAST NUMBER</div>
        <div id="lastNumber" class="last-number">-</div>
      </div>

      <div class="history">
        <div style="margin-bottom:6px;color:#a7f3d0;">LAST 10 NUMBERS</div>
        <div id="historyList"></div>
      </div>
    </div>
  </div>

<script>
  const board = document.getElementById("board");
  const lastNumberEl = document.getElementById("lastNumber");
  const lastBox = document.getElementById("lastBox");
  const historyList = document.getElementById("historyList");
  const drawBtn = document.getElementById("drawBtn");
  const speedSelect = document.getElementById("speedSelect");

  let numbers = [];
  let history = [];
  let autoDrawInterval = null;

  function createBoard() {
    board.innerHTML = "";
    numbers = [];
    history = [];
    historyList.innerHTML = "";
    lastNumberEl.textContent = "-";

    for (let i = 1; i <= 90; i++) {
      const cell = document.createElement("div");
      cell.className = "cell";
      cell.id = "cell-" + i;
      cell.textContent = i;
      board.appendChild(cell);
      numbers.push(i);
    }
  }

  function getTeluguVoice() {
    const voices = speechSynthesis.getVoices();
    return voices.find(v => v.lang.toLowerCase().includes("te")) ||
           voices.find(v => v.lang.toLowerCase().includes("en-in")) ||
           voices[0];
  }

  function speakNumber(num) {
    speechSynthesis.cancel();
    const msg = new SpeechSynthesisUtterance(num);
    msg.voice = getTeluguVoice();
    msg.rate = 0.9;
    msg.pitch = 1.2;
    speechSynthesis.speak(msg);
  }

  function drawNumber(numFromRemote = null) {
    if (numbers.length === 0) return alert("All numbers drawn!");

    const num = numFromRemote ?? numbers.splice(Math.floor(Math.random() * numbers.length), 1)[0];

    lastNumberEl.textContent = num;

    const cell = document.getElementById("cell-" + num);
    cell.classList.add("drawn", "glow");
    setTimeout(() => cell.classList.remove("glow"), 1200);

    lastBox.classList.remove("glow");
    void lastBox.offsetWidth;
    lastBox.classList.add("glow");

    history.unshift(num);
    history = history.slice(0, 10);
    historyList.innerHTML = history.map(n => `<span>${n}</span>`).join("");

    speakNumber(num);
  }

  function startAutoDraw() {
    if (autoDrawInterval) return;

    drawBtn.disabled = true;
    drawBtn.style.opacity = 0.6;

    const speed = Number(speedSelect.value);

    autoDrawInterval = setInterval(() => {
      if (numbers.length === 0) {
        stopAutoDraw();
        alert("All numbers drawn!");
        return;
      }
      drawNumber();
    }, speed);
  }

  function stopAutoDraw() {
    clearInterval(autoDrawInterval);
    autoDrawInterval = null;
    drawBtn.disabled = false;
    drawBtn.style.opacity = 1;
  }

  function resetGame() {
    speechSynthesis.cancel();
    stopAutoDraw();
    createBoard();
  }

  function toggleFullscreen() {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen();
    } else {
      document.exitFullscreen();
    }
  }

  const channel = new BroadcastChannel("housie-remote");
  channel.onmessage = (e) => {
    if (e.data === "draw") drawNumber();
    if (e.data === "reset") resetGame();
  };

  createBoard();
</script>

</body>
</html>
